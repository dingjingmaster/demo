# 汇编语言与汇编软件

## 汇编语言简介

指令和被指令引用的数据在内存中都是一些或高或低的电平，每一个电平都可以看成是一个二进制位（0 或者 1），8 个二进制位形成一字节。

要解读内存中的东西，最好的办法就是将它们按字节转换成数字的形式。比如，下面这些数字就是存放在内存中的 8086 指令，我们用的是十六进制：

```asm
B8 3F 00 01 C3 01 C1
```

对于大多数人来说，他们很难想象上面那一排数字对应着下面几条 8086 指令：
```
将立即数 003FH 传送到寄存器 AX；
将寄存器 BX 的内容和寄存器 AX 的内容相加，结果在 BX 中；
将寄存器 CX 的内容和寄存器 AX 的内容相加，结果在 CX 中。
```

即使是很有经验的技术人员，要想用这种方式来编写指令，也是很困难的，而且很容易出错。

为了克服机器指令难以书写和理解的缺点，人们想到可以用一些容易理解和记忆的符号，也就是助记符，来描述指令的功能和操作数的类型，这就产生了汇编语言（Assembly Language）。
这样，上面那些指令就可以写成：

```asm
mov ax,3FH
add bx,ax
add cx,ax
```

> 汇编语言对指令的大小写没有特别的要求。

在很多高级语言中，如果要指示一个数是十六进制数，通常不采用在后面加“H”的做法，而是为它添加一个“0x”前缀。像这样：
```asm
mov ax,0x3f
```

在汇编语言中，使用十进制数是最自然的。因为 3FH 等于十进制数 63，所以你可以直接这样写：
```asm
mov ax,63
```

当然，如果你喜欢，也可以使用二进制数来这样写：
```asm
mov ax,00111111B
```

> 一定要看清楚，在那串“0”和“1”的组合后面，跟着字母“B”，以表明它是一个二进制数。

## NASM 编译器

### 从网上下载NASM安装程序

现存的汇编语言编译器有多种，用得比较多的有 MASM、FASM、TASM、AS86、GASM等，每种汇编器都有自己的特色和局限性。特别是，有些还需要付费才能使用。不同于前面所列举的这些，在本书中，我们用的是另一款叫做 NASM 的汇编语言编译器。

NASM 的全称是 Netwide Assembler，它是可免费使用的开源软件。下面是它的下载地址：[http://sourceforge.net/projects/nasm/files/](http://sourceforge.net/projects/nasm/files/)

理论上，不管用的是什么操作系统，Windows 也好，DOS 也好，Linux 也好，只要是针对Intel 处理器开发的软件，底层的机器指令代码都是相同的，没有理由说某个软件只能在Windows 操作系统上运行，而不能在 Linux 上运行。

事实上，仅仅具有一致的底层机器代码还远远不够。别忘了，这些代码要被处理器来依次执行，首先需要加载到内存并实施重定位。在这种情况下，除了那些真正用于做事的机器指令之外，软件还需要一些额外的信息来告诉操作系统，如何加载自己。

因为每种操作系统都会根据自身的工作特点，定义自己所能识别的软件可执行文件格式，而缺乏通用性，尽管在这些软件里，真正用于计算 5+6 的机器指令都一模一样。

### 下载配书源码和工具

一旦有了一个源程序，下一步就是将它的内容编译成机器代码。为此，可以从开始菜单里找到“Netwide Assembler 2.07”，然后选择其下的“Nasm Shell”，这将打开一个命令行窗口。接着，在命令行提示符后输入“nasm –f bin exam.asm –o exam.bin”并按 Enter 键完成编译。

NASM 需要一系列参数才能正常工作。-f 参数的作用是指定输出文件的格式（Format）。这样，-f bin 就是要求 NASM 生成的文件只包含“纯二进制”的内容。换句话说，除了处理器能够识别的机器代码外，别的任何东西都不包含。这样一来，因为缺少操作系统所需要的加载和重定位信息，它就很难在 Windows、DOS 和 Linux 上作为一个普通的应用程序运行。

-o 参数指定编译后输出（Output）的文件名。

所有源码和工具下载地址[http://download.csdn.net/detail/sholber/4561356](http://download.csdn.net/detail/sholber/4561356)

### 用 HexView 观察编译后的机器代码

文件选择之后，HexView 程序将以十六进制的形式显示刚刚选择的文件。在 HexView 中，文件的内容以十六进制的形式显示在窗口中间，以 16 个字节为一行，字节之间以空白分隔，所以看起来很稀疏。如果文件较大的话，则会分成很多行。

作为对照，每个字节还会以字符的形式显示在窗口右侧，如果它确实可显示为一个字符的话。如果该字节并非一个可以显示的字符，则显示一个替代的字符“.”。因为源程序中还有汉字注释，所以，如果细心的话，从图中可以算出每个汉字的编码是两个字节，比如“将”字的编码是 0xBD 0xAB。由于 HexView 以单字节的形式来显示每个字符，所以无法显示汉字。左边的数字，是每一行第一个字节相对于文件头部的距离（偏移），也是以十六进制数显示的。
