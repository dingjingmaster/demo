# UTF-8 å­—ç¬¦éªŒè¯å™¨

ä¸€ä¸ªç”¨ Linux C å®ç°çš„å®Œæ•´ UTF-8 å­—ç¬¦éªŒè¯åº“ï¼Œå¯ä»¥åˆ¤æ–­å­—èŠ‚åºåˆ—æ˜¯å¦æ„æˆå®Œæ•´æœ‰æ•ˆçš„ UTF-8 å­—ç¬¦ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **å®Œæ•´æ€§æ£€æŸ¥**: åˆ¤æ–­ UTF-8 å­—ç¬¦åºåˆ—æ˜¯å¦å®Œæ•´
- âœ… **æœ‰æ•ˆæ€§éªŒè¯**: æ£€æŸ¥ UTF-8 ç¼–ç æ˜¯å¦ç¬¦åˆæ ‡å‡†
- âœ… **è¿‡é•¿ç¼–ç æ£€æµ‹**: è¯†åˆ«å¹¶æ‹’ç»è¿‡é•¿ç¼–ç 
- âœ… **ä»£ç†å¯¹æ£€æµ‹**: æ£€æµ‹æ— æ•ˆçš„ä»£ç†å¯¹èŒƒå›´
- âœ… **å­—ç¬¦è®¡æ•°**: è®¡ç®— UTF-8 å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ•°ï¼ˆéå­—èŠ‚æ•°ï¼‰
- âœ… **å­—ç¬¦ä¸²éªŒè¯**: éªŒè¯æ•´ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæœ‰æ•ˆ UTF-8

## UTF-8 ç¼–ç è§„åˆ™

UTF-8 æ˜¯ä¸€ç§å˜é•¿ç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦å¯ä»¥ç”¨ 1-4 ä¸ªå­—èŠ‚è¡¨ç¤ºï¼š

| å­—ç¬¦èŒƒå›´ | å­—èŠ‚æ•° | ç¬¬1å­—èŠ‚ | ç¬¬2å­—èŠ‚ | ç¬¬3å­—èŠ‚ | ç¬¬4å­—èŠ‚ |
|----------|--------|---------|---------|---------|---------|
| U+0000 - U+007F | 1 | 0xxxxxxx | - | - | - |
| U+0080 - U+07FF | 2 | 110xxxxx | 10xxxxxx | - | - |
| U+0800 - U+FFFF | 3 | 1110xxxx | 10xxxxxx | 10xxxxxx | - |
| U+10000 - U+10FFFF | 4 | 11110xxx | 10xxxxxx | 10xxxxxx | 10xxxxxx |

## æ–‡ä»¶ç»“æ„

```
â”œâ”€â”€ utf8_validator.h    # å¤´æ–‡ä»¶ï¼ŒåŒ…å«å‡½æ•°å£°æ˜
â”œâ”€â”€ utf8_validator.c    # æ ¸å¿ƒå®ç°ï¼ŒUTF-8 éªŒè¯é€»è¾‘
â”œâ”€â”€ utf8_example.c      # ä½¿ç”¨ç¤ºä¾‹å’Œæµ‹è¯•ç¨‹åº
â”œâ”€â”€ Makefile           # ç¼–è¯‘è„šæœ¬
â””â”€â”€ README.md          # æœ¬æ–‡ä»¶
```

## å¿«é€Ÿå¼€å§‹

### ç¼–è¯‘

```bash
# ç¼–è¯‘æ‰€æœ‰ç›®æ ‡
make all

# æˆ–è€…åªç¼–è¯‘ç¤ºä¾‹ç¨‹åº
make utf8_example

# ç¼–è¯‘é™æ€åº“
make libutf8validator.a
```

### è¿è¡Œç¤ºä¾‹

```bash
make run
```

### åŸºæœ¬ä½¿ç”¨

```c
#include "utf8_validator.h"

// æ£€æŸ¥å•ä¸ª UTF-8 å­—ç¬¦
const uint8_t data[] = {0xE4, 0xB8, 0xAD}; // "ä¸­"
size_t consumed = 0;
utf8_result_t result = validate_utf8_char(data, sizeof(data), &consumed);

if (result == UTF8_VALID) {
    printf("æœ‰æ•ˆçš„ UTF-8 å­—ç¬¦ï¼Œé•¿åº¦: %zu å­—èŠ‚\n", consumed);
}

// éªŒè¯æ•´ä¸ªå­—ç¬¦ä¸²
const char *str = "Hello ä¸–ç•Œ ğŸŒ";
if (is_valid_utf8_string((const uint8_t*)str, strlen(str))) {
    printf("æœ‰æ•ˆçš„ UTF-8 å­—ç¬¦ä¸²\n");
    int char_count = count_utf8_chars((const uint8_t*)str, strlen(str));
    printf("åŒ…å« %d ä¸ªå­—ç¬¦\n", char_count);
}
```

## API å‚è€ƒ

### æ ¸å¿ƒå‡½æ•°

#### `validate_utf8_char()`
```c
utf8_result_t validate_utf8_char(const uint8_t *data, size_t len, size_t *consumed);
```
éªŒè¯å•ä¸ª UTF-8 å­—ç¬¦æ˜¯å¦å®Œæ•´ä¸”æœ‰æ•ˆã€‚

**å‚æ•°:**
- `data`: æŒ‡å‘å­—èŠ‚åºåˆ—çš„æŒ‡é’ˆ
- `len`: å¯ç”¨çš„å­—èŠ‚æ•°
- `consumed`: è¾“å‡ºå‚æ•°ï¼Œå®é™…æ¶ˆè€—çš„å­—èŠ‚æ•°

**è¿”å›å€¼:**
- `UTF8_VALID`: å®Œæ•´æœ‰æ•ˆçš„ UTF-8 å­—ç¬¦
- `UTF8_INCOMPLETE`: ä¸å®Œæ•´ï¼ˆéœ€è¦æ›´å¤šå­—èŠ‚ï¼‰
- `UTF8_INVALID`: æ— æ•ˆçš„ UTF-8 åºåˆ—

#### `is_valid_utf8_string()`
```c
bool is_valid_utf8_string(const uint8_t *data, size_t len);
```
éªŒè¯æ•´ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ UTF-8ã€‚

#### `count_utf8_chars()`
```c
int count_utf8_chars(const uint8_t *data, size_t len);
```
è®¡ç®— UTF-8 å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ•°ï¼ˆéå­—èŠ‚æ•°ï¼‰ã€‚

### è¾…åŠ©å‡½æ•°

#### `get_utf8_char_length()`
```c
int get_utf8_char_length(uint8_t first_byte);
```
æ ¹æ®ç¬¬ä¸€ä¸ªå­—èŠ‚è·å– UTF-8 å­—ç¬¦çš„æœŸæœ›é•¿åº¦ã€‚

#### `is_utf8_start_byte()`
```c
bool is_utf8_start_byte(uint8_t byte);
```
åˆ¤æ–­å­—èŠ‚æ˜¯å¦æ˜¯ UTF-8 åºåˆ—çš„å¼€å§‹å­—èŠ‚ã€‚

#### `is_utf8_continuation_byte()`
```c
bool is_utf8_continuation_byte(uint8_t byte);
```
åˆ¤æ–­å­—èŠ‚æ˜¯å¦æ˜¯ UTF-8 åºåˆ—çš„ç»§ç»­å­—èŠ‚ã€‚

## éªŒè¯è§„åˆ™

æœ¬åº“ä¸¥æ ¼æŒ‰ç…§ UTF-8 æ ‡å‡†è¿›è¡ŒéªŒè¯ï¼ŒåŒ…æ‹¬ï¼š

1. **å­—èŠ‚æ ¼å¼æ£€æŸ¥**: ç¡®ä¿æ¯ä¸ªå­—èŠ‚ç¬¦åˆ UTF-8 æ ¼å¼
2. **é•¿åº¦ä¸€è‡´æ€§**: éªŒè¯å®é™…é•¿åº¦ä¸ç¬¬ä¸€å­—èŠ‚æŒ‡ç¤ºçš„é•¿åº¦ä¸€è‡´
3. **æœ€çŸ­ç¼–ç **: æ‹’ç»è¿‡é•¿ç¼–ç ï¼ˆå¦‚ç”¨ 2 å­—èŠ‚ç¼–ç  ASCII å­—ç¬¦ï¼‰
4. **ä»£ç ç‚¹èŒƒå›´**: æ£€æŸ¥ä»£ç ç‚¹æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
5. **ä»£ç†å¯¹æ£€æµ‹**: æ‹’ç» UTF-16 ä»£ç†å¯¹èŒƒå›´ï¼ˆU+D800-U+DFFFï¼‰
6. **æœ€å¤§å€¼æ£€æŸ¥**: ç¡®ä¿ 4 å­—èŠ‚åºåˆ—ä¸è¶…è¿‡ U+10FFFF

## æµ‹è¯•ç”¨ä¾‹

ç¤ºä¾‹ç¨‹åºåŒ…å«ä»¥ä¸‹æµ‹è¯•ï¼š

- ASCII å­—ç¬¦ (1 å­—èŠ‚)
- æ‹‰ä¸æ‰©å±•å­—ç¬¦ (2 å­—èŠ‚)
- ä¸­æ—¥éŸ©å­—ç¬¦ (3 å­—èŠ‚)  
- è¡¨æƒ…ç¬¦å· (4 å­—èŠ‚)
- ä¸å®Œæ•´åºåˆ—
- æ— æ•ˆåºåˆ—
- è¿‡é•¿ç¼–ç 
- æ··åˆå­—ç¬¦ä¸²

## å†…å­˜ç®¡ç†

- æ‰€æœ‰å‡½æ•°éƒ½æ˜¯çº¯å‡½æ•°ï¼Œä¸åˆ†é…å†…å­˜
- å‚æ•°éªŒè¯ç¡®ä¿ä¸ä¼šè®¿é—®æ— æ•ˆå†…å­˜
- ä½¿ç”¨ `valgrind` éªŒè¯æ— å†…å­˜æ³„æ¼

## ç¼–è¯‘é€‰é¡¹

```bash
# è°ƒè¯•ç‰ˆæœ¬
make debug

# å†…å­˜æ£€æŸ¥
make memcheck

# ç³»ç»Ÿå®‰è£…
make install

# æ¸…ç†
make clean
```

## ç³»ç»Ÿè¦æ±‚

- Linux ç³»ç»Ÿ
- GCC ç¼–è¯‘å™¨
- æ”¯æŒ C99 æ ‡å‡†
- å¯é€‰ï¼švalgrindï¼ˆç”¨äºå†…å­˜æ£€æŸ¥ï¼‰

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## å‚è€ƒèµ„æ–™

- [RFC 3629 - UTF-8](https://tools.ietf.org/html/rfc3629)
- [Unicode Standard](https://www.unicode.org/standard/standard.html)
- [UTF-8 Wikipedia](https://en.wikipedia.org/wiki/UTF-8) 